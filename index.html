<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Hub - Final Exam</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .backface-hidden { backface-visibility: hidden; }
        .transform-style-3d { transform-style: preserve-3d; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.40.0",
    "react": "https://esm.sh/react@^19.2.4",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <!-- Import Google GenAI as global -->
    <script type="module">
        import { GoogleGenAI, Type } from "https://esm.sh/@google/genai@^1.40.0";
        window.GoogleGenAI = GoogleGenAI;
        window.GeminiType = Type;
    </script>

    <!-- Main App Logic (JSX) -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Language = { JA: 'ja', EN: 'en' };

        const UI_STRINGS = {
            [Language.EN]: {
                title: "Learning Hub",
                subtitle: "Master Japanese vocabulary with AI-powered cards and 10-question quizzes",
                inputPlaceholder: "Enter a Japanese word (e.g., 絆, 木漏れ日)...",
                generateBtn: "Generate Study Set",
                loadingText: "AI is creating your personalized study material...",
                flashcardTitle: "Flashcard",
                quizTitle: "Knowledge Quiz (10 Questions)",
                flipPrompt: "Click card to flip",
                nextBtn: "Next",
                prevBtn: "Previous",
                finishBtn: "Show Results",
                scoreText: "Your Final Score",
                restartBtn: "Start New Session",
                errorText: "An error occurred. Please ensure your environment is set up correctly."
            },
            [Language.JA]: {
                title: "学習ハブ",
                subtitle: "AIが生成するフラッシュカードと10問クイズで単語をマスター",
                inputPlaceholder: "日本語の単語を入力してください (例: 絆、木漏れ日)...",
                generateBtn: "学習セットを作成",
                loadingText: "AIがパーソナライズされた教材を作成中...",
                flashcardTitle: "フラッシュカード",
                quizTitle: "確認クイズ（10問）",
                flipPrompt: "クリックして裏返す",
                nextBtn: "次へ",
                prevBtn: "前へ",
                finishBtn: "結果を表示",
                scoreText: "最終スコア",
                restartBtn: "新しいセッションを開始",
                errorText: "エラーが発生しました。設定を確認してください。"
            }
        };

        const App = () => {
            const [lang, setLang] = useState(Language.JA);
            const [keyword, setKeyword] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [data, setData] = useState(null);

            const ui = UI_STRINGS[lang];

            const handleGenerate = async (e) => {
                e.preventDefault();
                if (!keyword.trim()) return;

                setIsLoading(true);
                setError(null);
                setData(null);

                try {
                    const ai = new window.GoogleGenAI({ apiKey: "REPLACE_WITH_KEY_IF_NEEDED" || (typeof process !== 'undefined' ? process.env.API_KEY : '') });
                    const model = 'gemini-3-pro-preview';
                    
                    const prompt = `Generate a Japanese study set for: "${keyword}".
                    UI Language: ${lang === 'en' ? 'English' : 'Japanese'}.
                    Requirements:
                    1. One comprehensive flashcard.
                    2. EXACTLY 10 multiple-choice questions (4 options each).
                    3. Output MUST be valid JSON.`;

                    const response = await ai.models.generateContent({
                        model,
                        contents: [{ parts: [{ text: prompt }] }],
                        config: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: window.GeminiType.OBJECT,
                                properties: {
                                    term: { type: window.GeminiType.STRING },
                                    reading: { type: window.GeminiType.STRING },
                                    meaning: { type: window.GeminiType.STRING },
                                    explanation: { type: window.GeminiType.STRING },
                                    exampleSentence: { type: window.GeminiType.STRING },
                                    exampleMeaning: { type: window.GeminiType.STRING },
                                    quizzes: {
                                        type: window.GeminiType.ARRAY,
                                        items: {
                                            type: window.GeminiType.OBJECT,
                                            properties: {
                                                question: { type: window.GeminiType.STRING },
                                                options: { type: window.GeminiType.ARRAY, items: { type: window.GeminiType.STRING } },
                                                correctAnswerIndex: { type: window.GeminiType.INTEGER },
                                                explanation: { type: window.GeminiType.STRING }
                                            },
                                            required: ["question", "options", "correctAnswerIndex", "explanation"]
                                        }
                                    }
                                },
                                required: ["term", "reading", "meaning", "explanation", "exampleSentence", "quizzes"]
                            }
                        }
                    });

                    const result = JSON.parse(response.text);
                    setData(result);
                } catch (err) {
                    console.error(err);
                    setError(ui.errorText);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col">
                    <header className="sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-slate-200">
                        <div className="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center space-x-2">
                                <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold italic">L</div>
                                <h1 className="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">{ui.title}</h1>
                            </div>
                            <div className="flex bg-slate-100 rounded-full p-1 border border-slate-200">
                                <button onClick={() => setLang(Language.JA)} className={`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${lang === Language.JA ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>日本語</button>
                                <button onClick={() => setLang(Language.EN)} className={`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${lang === Language.EN ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>EN</button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-4xl mx-auto w-full px-4 py-10">
                        {!data && !isLoading && (
                            <div className="mt-16 text-center animate-fadeIn">
                                <h2 className="text-5xl font-black text-slate-800 mb-4">{ui.title}</h2>
                                <p className="text-lg text-slate-500 mb-12">{ui.subtitle}</p>
                                <form onSubmit={handleGenerate} className="flex gap-2 max-w-2xl mx-auto">
                                    <input 
                                        type="text" 
                                        value={keyword} 
                                        onChange={(e) => setKeyword(e.target.value)} 
                                        placeholder={ui.inputPlaceholder} 
                                        className="flex-1 bg-white border-2 border-slate-200 focus:border-indigo-500 rounded-2xl py-5 px-8 text-lg outline-none shadow-sm transition-all"
                                    />
                                    <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-10 rounded-2xl shadow-lg shadow-indigo-100 transition-all">{ui.generateBtn}</button>
                                </form>
                                {error && <div className="mt-6 text-red-500 bg-red-50 p-4 rounded-xl border border-red-100">{error}</div>}
                            </div>
                        )}

                        {isLoading && (
                            <div className="flex flex-col items-center justify-center py-24 animate-pulse">
                                <div className="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-6"></div>
                                <p className="text-xl font-medium text-slate-600">{ui.loadingText}</p>
                            </div>
                        )}

                        {data && (
                            <div className="animate-fadeIn space-y-16">
                                <div className="flex items-center justify-between">
                                    <button onClick={() => setData(null)} className="text-slate-500 hover:text-indigo-600 flex items-center font-bold">
                                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                                        Back
                                    </button>
                                    <h3 className="bg-indigo-600 text-white px-6 py-2 rounded-full font-bold shadow-md">{data.term} ({data.reading})</h3>
                                </div>

                                <section>
                                    <h4 className="text-2xl font-bold mb-8 flex items-center"><span className="w-1.5 h-8 bg-indigo-500 mr-4 rounded-full"></span>{ui.flashcardTitle}</h4>
                                    <FlashcardView data={data} ui={ui} />
                                </section>

                                <section className="pt-16 border-t border-slate-200">
                                    <h4 className="text-2xl font-bold mb-10 flex items-center"><span className="w-1.5 h-8 bg-purple-500 mr-4 rounded-full"></span>{ui.quizTitle}</h4>
                                    <QuizView questions={data.quizzes} ui={ui} onRestart={() => setData(null)} />
                                </section>
                            </div>
                        )}
                    </main>
                    <footer className="py-12 text-center text-slate-400 text-sm border-t border-slate-200">
                        © 2024 Learning Hub - Final Submission
                    </footer>
                </div>
            );
        };

        const FlashcardView = ({ data, ui }) => {
            const [flipped, setFlipped] = useState(false);
            return (
                <div className="relative w-full max-w-md h-96 mx-auto perspective-1000 cursor-pointer" onClick={() => setFlipped(!flipped)}>
                    <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d ${flipped ? 'rotate-y-180' : ''}`}>
                        {/* Front */}
                        <div className="absolute w-full h-full backface-hidden bg-white border border-slate-200 rounded-[2.5rem] shadow-2xl flex flex-col items-center justify-center p-12">
                            <span className="text-indigo-600 font-bold tracking-widest uppercase mb-4 opacity-70">{data.reading}</span>
                            <h5 className="text-7xl font-black text-slate-800">{data.term}</h5>
                            <p className="text-slate-400 text-sm mt-16 animate-bounce">{ui.flipPrompt}</p>
                        </div>
                        {/* Back */}
                        <div className="absolute w-full h-full backface-hidden bg-indigo-600 text-white rounded-[2.5rem] shadow-2xl flex flex-col p-10 rotate-y-180 overflow-y-auto">
                            <h5 className="text-3xl font-bold border-b border-indigo-400/50 pb-4 mb-6">{data.meaning}</h5>
                            <p className="text-lg leading-relaxed mb-8 opacity-90">{data.explanation}</p>
                            <div className="mt-auto bg-black/20 p-6 rounded-2xl border border-white/10">
                                <p className="text-xs font-bold text-indigo-200 mb-2 uppercase tracking-widest">Example</p>
                                <p className="text-xl leading-snug">{data.exampleSentence}</p>
                                {data.exampleMeaning && <p className="text-indigo-200 text-sm mt-2 italic">{data.exampleMeaning}</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const QuizView = ({ questions, ui, onRestart }) => {
            const [idx, setIdx] = useState(0);
            const [ans, setAns] = useState(null);
            const [show, setShow] = useState(false);
            const [score, setScore] = useState(0);
            const [done, setDone] = useState(false);

            const handleAns = (i) => {
                if (show) return;
                setAns(i);
                setShow(true);
                if (i === questions[idx].correctAnswerIndex) setScore(s => s + 1);
            };

            const next = () => {
                if (idx < questions.length - 1) {
                    setIdx(idx + 1);
                    setAns(null);
                    setShow(false);
                } else setDone(true);
            };

            if (done) return (
                <div className="bg-white rounded-3xl p-12 shadow-xl text-center max-w-lg mx-auto animate-fadeIn border border-slate-100">
                    <div className="text-indigo-600 mb-6">
                        <svg className="w-20 h-20 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <h4 className="text-3xl font-black text-slate-800 mb-2">{ui.scoreText}</h4>
                    <div className="text-8xl font-black text-indigo-600 mb-10">{score}/10</div>
                    <button onClick={onRestart} className="w-full bg-slate-900 hover:bg-black text-white font-bold py-5 rounded-2xl shadow-lg transition-all">{ui.restartBtn}</button>
                </div>
            );

            const q = questions[idx];
            return (
                <div className="max-w-2xl mx-auto animate-fadeIn">
                    <div className="mb-8 flex justify-between items-end px-2">
                        <span className="text-sm font-bold text-slate-400">Question {idx + 1} of 10</span>
                        <div className="w-48 h-2 bg-slate-200 rounded-full overflow-hidden shadow-inner">
                            <div className="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-500" style={{width:`${(idx+1)*10}%`}}></div>
                        </div>
                    </div>
                    <div className="bg-white rounded-[2rem] p-10 shadow-xl border border-slate-100">
                        <h4 className="text-2xl font-bold text-slate-800 mb-10 leading-snug">{q.question}</h4>
                        <div className="space-y-4">
                            {q.options.map((opt, i) => {
                                let style = "border-slate-100 bg-slate-50 hover:bg-white hover:border-indigo-300 hover:shadow-md";
                                if (show) {
                                    if (i === q.correctAnswerIndex) style = "bg-green-100 border-green-500 text-green-800 shadow-sm";
                                    else if (i === ans) style = "bg-red-100 border-red-500 text-red-800 shadow-sm";
                                    else style = "opacity-40 grayscale-[0.5]";
                                }
                                return (
                                    <button key={i} disabled={show} onClick={() => handleAns(i)} className={`w-full text-left px-8 py-5 rounded-2xl border-2 font-semibold transition-all flex items-center ${style}`}>
                                        <span className="w-8 h-8 rounded-full border border-slate-300 flex items-center justify-center mr-4 text-xs font-black">{String.fromCharCode(65+i)}</span>
                                        {opt}
                                    </button>
                                );
                            })}
                        </div>
                        {show && (
                            <div className="mt-10 pt-10 border-t border-slate-100 animate-fadeIn">
                                <div className="bg-slate-50 p-6 rounded-2xl mb-8 border-l-4 border-indigo-500">
                                    <p className="text-slate-600 leading-relaxed italic">{q.explanation}</p>
                                </div>
                                <button onClick={next} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-5 rounded-2xl shadow-lg shadow-indigo-100 transition-all">
                                    {idx === 9 ? ui.finishBtn : ui.nextBtn}
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>